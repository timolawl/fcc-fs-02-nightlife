{"version":3,"sources":["../../../node_modules/browser-pack/_prelude.js","post.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module","conductSearch","searchValue","document","querySelector","bars","style","classList","add","firstChild","removeChild","remove","socket","emit","location","sessionStorage","setItem","toggleView","inputLength","logoutAction","logStatus","contains","toggle","createListing","business","listings","widthContainer","createElement","className","appendChild","card","cardSection","img","src","image_url","barTitle","id","barLink","href","url","textContent","name","barReview","excerpt","goingButton","attending","setAttribute","goingCount","guestCount","goingText","io","window","onload","searchInput","addEventListener","removeItem","getItem","value","Array","prototype","forEach","querySelectorAll","el","target","key","which","keyCode","on","data","yelpReviews","reviews","createDocumentFragment","masonrySizer","listingNumber","images","imagesLoaded","event","parentNode","barID","parseInt","bar","Masonry","itemSelector","columnWidth","percentPosition"],"mappings":"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","file":"post.bundle.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","'use strict';\n\n// socket io -- the cdnjs script is in the HTML template above this script file\nvar socket = io();\n\nwindow.onload = function () {\n\n\n  var logStatus = document.querySelector('.mainbox__log-button').textContent;\n\n  var logoBtn = document.querySelector('.bn-logo--link').addEventListener('click', e => {\n    sessionStorage.removeItem('searchLocation');\n    location.href = '/';\n  });\n\n  var searchInput;\n\n  // if a search of a previous session has been completed..\n  if (sessionStorage.getItem('searchLocation')) {\n    searchInput = sessionStorage.getItem('searchLocation');\n  }\n  else searchInput = '';\n\n  // if document referrer was the login completion,\n  // and logstatus is logged in\n  // populate the input field with the previous input and do a search.\n // console.log('document.referrer: ' + document.referrer);\n // console.log('search input: ' + searchInput);\n  \n  if (searchInput) {\n    document.querySelector('.mainbox__search--input').value = searchInput;\n    // move items to top\n    toggleView(searchInput.length, false, logStatus);\n        // generate results\n    conductSearch(searchInput);\n  }\n\n\n  // show modal on clicking the log in button\n  Array.prototype.forEach.call(document.querySelectorAll('.mainbox__log-button'), el => el.addEventListener('click', () => {\n    if (logStatus === 'Log In') {\n      document.querySelector('.overlay').classList.remove('visibility--hide');\n      document.querySelector('.modal').classList.remove('display--hide');\n    }\n    else if (logStatus === 'Log Out') {\n      sessionStorage.removeItem('searchLocation');\n      // adding this because the redirect to find out that there should be nothing here is a bit slow...\n      document.querySelector('.mainbox__search--input').value = '';\n\n      \n      //basically conductSearch in reverse\n      document.querySelector('.bar-list').classList.add('visibility--hide');\n      document.querySelector('footer').classList.add('footer--unsearched');\n      if (document.querySelector('.mainbox').classList.contains('mainbox--top')) {\n        toggleView(0, true, logStatus); // passing a length of 0\n      }\n      location.href = '/logout'; \n    }\n  }));\n\n  // on submit, reveal results and unfix the display of footer\n  document.querySelector('.mainbox__search').addEventListener('click', e => {\n    searchInput = document.querySelector('.mainbox__search--input').value;\n    // on submit button press and with content in input box:\n    if (e.target.classList.contains('mainbox__search--submit') && searchInput) { // submit button pressed with inputted content\n      // emit socket\n      // server side environmental variables are needed so the ajax call is better off not performed here\n      conductSearch(searchInput);\n    }\n  });\n\n  document.querySelector('.mainbox__search').addEventListener('keyup', e => {\n    // on mainbox focus and enter key press with content in input box:\n    searchInput = document.querySelector('.mainbox__search--input').value;\n    var key = e.which || e.keyCode;\n    if (key === 13 && searchInput) { // on enter key press\n      conductSearch(searchInput);\n    }\n  });\n\n\n  // when there is input, change view to have search bar at the top of the page\n  document.querySelector('.mainbox__search--input').addEventListener('input', e => {\n    // if there is content and the previous state was empty, toggle\n    //if ((e.target.value || e.target.length !== 0) && previousState.length === 0) {\n    \n    //}\n   // console.log(e.target.value);\n  //  console.log(e.target.length);\n    toggleView(e.target.value.length, false, logStatus);\n  });\n\n  // When the modal close button or the overlay is clicked, exit the modal condition\n  document.querySelector('.social-login__close').addEventListener('click', () => {\n    document.querySelector('.overlay').classList.add('visibility--hide');\n    document.querySelector('.modal').classList.add('display--hide');\n  });\n  \n  document.querySelector('.overlay').addEventListener('click', () => {\n    document.querySelector('.overlay').classList.add('visibility--hide');\n    document.querySelector('.modal').classList.add('display--hide');\n  });\n\n};\n\n\nfunction conductSearch (searchValue) {\n  // remove previous results\n  if (document.querySelector('.masonry-element')) {\n    let bars = document.querySelector('.bar-list');\n    bars.style = 'position: relative';\n    document.querySelector('footer').classList.add('footer--unsearched');\n\n    while (bars.firstChild) {\n      bars.removeChild(bars.firstChild);\n    }\n  }\n  // show cog loader while loading...\n  document.querySelector('.bar-list__loader').classList.remove('display--hide');\n  // send request to server to send request to yelp API\n  socket.emit('bar search', { location: searchValue });\n  // store the most recent search location in sessionStorage\n  sessionStorage.setItem('searchLocation', searchValue);\n // console.log('session storage set: ' + sessionStorage.getItem('searchLocation'));\n\n\n}\n\nfunction toggleView (inputLength, logoutAction, logStatus) {\n  // if there is content and the top display is not already displayed, then toggle\n  // or if there is no content and regular display is not already displayed, then toggle\n  if ((inputLength && !document.querySelector('.mainbox').classList.contains('mainbox--top')) || logoutAction) {\n    document.querySelector('.mainbox').classList.toggle('mainbox--top'); // move mainbox to top\n    document.querySelector('.mainbox__search').classList.toggle('mainbox__search--top'); // left-aign search input\n    document.querySelector('.mainbox__title-row').classList.toggle('display--hide');\n    document.querySelector('.mainbox__title-row--top').classList.toggle('display--hide');\n    document.querySelector('.mainbox__subtitle-row').classList.toggle('display--hide');\n    document.querySelector('.mainbox__log-row').classList.toggle('display--hide');\n    document.querySelector('.mainbox__log-row--top').classList.toggle('display--hide');\n    \n    if (logStatus === 'Log Out') {\n      document.querySelector('.mainbox__login-details--top').classList.toggle('display--hide');\n    }\n    \n  }\n}\n\nsocket.on('bar results', function (data) {\n // console.log('socket emission received...');\n  const yelpReviews = data.reviews;\n  let listings = document.createDocumentFragment();\n  listings.className = 'visibility--hide';\n  let masonrySizer = document.createElement('div');\n  masonrySizer.className = 'masonry-element--sizer';\n  listings.appendChild(masonrySizer);\n  //console.log('business length: ' + yelpReviews.length);\n  for (let listingNumber = 0; listingNumber < yelpReviews.length; listingNumber++) {\n    /*\n    let currentRow;\n    if (listingNumber === 0 || listingNumber % 3 === 0) {\n      //create new row\n      let newRow = document.createElement('div')\n      newRow.className = 'row';\n      listings.appendChild(newRow);\n      currentRow = newRow;\n    }\n    else {\n      currentRow = listings.querySelector('.row:last-of-type')\n    }\n\n    createListing(yelpReviews[listingNumber], currentRow);\n    */\n    createListing(yelpReviews[listingNumber], listings);\n  }\n\n  //document.querySelector('.bar-list').appendChild(listings);\n\n  let images = listings.querySelectorAll('.img-fluid');\n\n  imagesLoaded(images, () => { // after all images have been loaded on the fragment\n\n    document.querySelector('.bar-list__loader').classList.add('display--hide');\n    document.querySelector('.bar-list').appendChild(listings); // append the fragment\n    Array.prototype.forEach.call(document.querySelectorAll('.going-button'), el => {\n      el.addEventListener('click', e => {\n        // check login status\n        // not logged in\n        if (document.querySelector('.mainbox__log-button').textContent === 'Log In') {\n          // show modal\n          document.querySelector('.overlay').classList.remove('visibility--hide');\n          document.querySelector('.modal').classList.remove('display--hide');\n          // save the 'going' choice..?\n\n        }\n        // logged in\n        else {\n          let event = e.target;\n          while (!event.classList.contains('button')) {\n            event = event.parentNode;\n          }\n          let barID = event.parentNode.querySelector('h6').classList[0];\n          // already going, but clicked to decide to not go\n          let goingCount = event.querySelector('.going-badge');\n          if (event.classList.contains('bar__attending')) {\n            event.classList.remove('bar__attending');\n            goingCount.textContent = parseInt(goingCount.textContent) - 1;\n            socket.emit('remove attendance', { bar: barID });\n          }\n          // if not going, but clicked to go\n          else {\n            event.classList.add('bar__attending');\n            goingCount.textContent = parseInt(goingCount.textContent) + 1;\n            socket.emit('add attendance', { bar: barID });\n          }\n        }\n        // check if already counted if logged in\n        // if counted and logged in, remove count and update db\n        // if not counted and logged in, add to count and update db\n      });\n    });\n    // start masonry\n    var msnry = new Masonry(document.querySelector('.bar-list'), {\n      itemSelector: '.masonry-element',\n      columnWidth: '.masonry-element--sizer',\n      percentPosition: true\n    });\n\n    document.querySelector('footer').classList.remove('footer--unsearched');\n  });\n\n/*\n  var grid = document.querySelector('.bar-list').imagesLoaded( () => {\n    grid.masonry({\n      itemSelector: '.masonry-element',\n      columnWidth: '.masonry-element--sizer',\n      percentPosition: true\n    });\n  });\n*/\n  /*\n  document.querySelector('.bar-list').appendChild(listings);\n\n  document.querySelector('.bar-list').imagesLoaded( () => {\n    document.querySelector('.bar-list  \n  });\n  */\n/*\n  var msnry = new Masonry('.bar-list', {\n    itemSelector: '.masonry-element',\n    columnWidth: '.masonry-element--sizer',\n    percentPosition: true\n  });\n  */\n\n});\n\nfunction createListing (business, listings) {\n // console.log('making listings..');\n // console.log(business);\n  let widthContainer = document.createElement('div');\n  widthContainer.className = 'masonry-element'; // column medium-4 large-4';\n  //row.appendChild(widthContainer);\n  listings.appendChild(widthContainer);\n  let card = document.createElement('div');\n  card.className = 'card';\n  widthContainer.appendChild(card);\n  let cardSection = document.createElement('div');\n  cardSection.className = 'card-section text-center';\n  card.appendChild(cardSection);\n  let img = document.createElement('img');\n  img.className = 'img-fluid img-thumbnail mx-auto d-block';\n  img.src = business.image_url;\n  cardSection.appendChild(img);\n  let barTitle = document.createElement('h6');\n  barTitle.className = business.id;\n  let barLink = document.createElement('a');\n  barLink.className = 'bar__title';\n  barLink.href = business.url;\n  barLink.textContent = business.name;\n  barTitle.appendChild(barLink);\n  cardSection.appendChild(barTitle);\n  let barReview = document.createElement('p');\n  barReview.className = 'card-text text-justify';\n  barReview.textContent = business.excerpt;\n  cardSection.appendChild(barReview);\n  let goingButton = document.createElement('button');\n  goingButton.className = 'button secondary going-button';\n  if (business.attending) {\n    goingButton.classList.add('bar__attending');\n  }\n  goingButton.setAttribute('type', 'button');\n  cardSection.appendChild(goingButton);\n  let goingCount = document.createElement('span');\n  goingCount.className = 'badge primary going-badge';\n  goingCount.textContent = business.guestCount || '0';\n  goingButton.appendChild(goingCount);\n  let goingText = document.createElement('span');\n  goingText.className = 'bar__going--text';\n  goingText.textContent = 'Going';\n  goingButton.appendChild(goingText);\n}\n"]}